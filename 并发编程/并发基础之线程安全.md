# 线程安全

## 1.原子性

原子性是指一个操作是不可中断的。即使是在多个线程一起执行的时候，一个操作一旦开始，就不会被其它线程干扰

## 2.有序性

在并发时，程序的执行可能就会出现乱序

一条指令的执行是可以分为很多步骤的

1. 取指 IF
2. 译码和取寄存器操作数 ID
3. 执行或者有效地址计算 EX
4. 存储器访问 MEM
5. 写回 WB

### 指令重排

![1530284737026](C:\Users\13441\Desktop\md\并发编程\并发基础之线程安全.assets\1530284737026.png)

![1530284744835](C:\Users\13441\Desktop\md\并发编程\并发基础之线程安全.assets\1530284744835.png)

![1530284767380](C:\Users\13441\Desktop\md\并发编程\并发基础之线程安全.assets\1530284767380.png)



**指令重排可以使流水线更加顺畅**

## 3.可见性

可见性是指当一个线程修改了某一个共享变量的值，其他线程是否能够立即知道这个修改。
– 编译器优化
– 硬件优化（如写吸收，批操作）

## 4.Happen-Before

 程序顺序原则：一个线程内保证语义的串行性
 volatile规则：volatile变量的写，先发生于读，这保证了volatile变量的可见性
 锁规则：解锁（unlock）必然发生在随后的加锁（lock）前
 传递性：A先于B，B先于C，那么A必然先于C
 线程的start()方法先于它的每一个动作
 线程的所有操作先于线程的终结（Thread.join()）
 线程的中断（interrupt()）先于被中断线程的代码
 对象的构造函数执行结束先于finalize()方法

## 5.线程安全的概念

指某个函数、函数库在多线程环境中被调用时，能够正确地处理各个线程的局部变量，使程序功能正确完成



